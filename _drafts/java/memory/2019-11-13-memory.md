---

---

# Java memory model - Основа

## Типы данных

Виртуальная машина Java оперирует двумя видами типов: примитивные и ссылочные типы. Примитивных типов существует всего лишь 8.

| **Типы данных** | Размер (bites) | **Дефолтное значение** |
| --------------- | -------------- | ---------------------- |
| byte            | 8              | 0                      |
| boolean         | 8              | false                  |
| short           | 16             | 0                      |
| char            | 16             | '\u0000'               |
| int             | 32             | 0                      |
| long            | 32             | 0L                     |
| float           | 64             | 0.0f                   |
| double          | 64             | 0.0d                   |

Cуществует три вида ссылочных типов:

- массивы,
- классы,
- интерфейсы.

При создании любого ссылочного типа создается объект и ссылка на этот объект. Можно провести аналогию, что объект - это телевизор, а ссылка - это пульт.

- Размер ссылок может быть 4 или 8 байт. 
- Размер объектов - ограничен только размером памяти.



### Как определить диапазон значений по размеру?

TODO



## Типы памяти JVM

### Регистр (`pc - program counter`)

Кадый поток `JVM` имеет собственный регистр (`pc - program counter`). Каждый поток выполняет в момент времени выполняет метод - текущий метод потока.

- Если выполняется `JVM` метод, то регистр хранит `returnAddress`.
- Если выполняется `native` метод, то значение регистра `undefined`.



### Стек (`Stack`)

При создании потока создается `stack`, который хранит:

- фреймы (`frame`), которые содержат:
  - локальные переменные,
  - промежуточные результаты,
  - возвращаемые значения.

Размер стека может быть задан спомощью `-Xss`:

````bash
java -Xss4m Test
````

Если при вычистлениях требуется больше памяти, то бросится `StackOverflowError`.

> Интересно, что спецификация `JVM` позволяет реализовывать `JVM` c динамически расширяемым `stack`'ом и кидать `OutOfMemoryError`, в случае превышения памяти.



**NOTES -> TODO**

- Because the Java Virtual Machine stack is never manipulated directly except to push and pop frames, frames may be heap allocated. 
- The memory for a Java Virtual Machine stack does not need to be contiguous.



### Куча (`Heap `)









### Method Area



### Run-Time Constant Pool



### Native Method Stacks



##  Frames



Пример программы!











The Java Virtual Machine expects that nearly all type checking is done prior to run time, typically by a compiler, and does not have to be done by the Java Virtual Machine itself.

The Java Virtual Machine contains explicit support for objects. An object is either a dynamically allocated class instance or an array

A reference to an object is considered to have Java Virtual Machine type `reference`



**Картинка**

![]({{ site.baseurl }}/img/functional-interfaces/1.png)



# Вопросы

1. Как диапазон значений по размеру, например для `int`?

   



Другие вопросы

1. Что такое `statically-typed`?
   - [The Java programming language is statically-typed, which means that all variables must first be declared before they can be used.](https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html)
2. Для чего можно и нельзя использовать `float` and `double` ?
3. Зачем существует класс `BigDecimal`?
4. [Почему "Relying on such default values, however, is generally considered bad programming style"?](https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html)



# Источники

1. [Primitive Data Types](https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html) 
2. https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html
3. [Википедия - Регистр процессора](https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80_%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%B0)
4. https://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html
5. https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html
6. https://www.baeldung.com/java-stack-heap



## [Скачать приложение]({{ site.baseurl }}/download/01-java/functional-interfaces.zip)